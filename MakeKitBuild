SUBDIRS="libmowgli"
MODULES="core compiler"
PROJECT_NAME="sigyn"

defaults()
{
    MK_PREFIX="/opt/sigyn"
}

configure()
{
    mk_config_header "include/config.h"

    mk_check_libraries mowgli
    mk_check_libraries dl
    mk_check_functions \
       HEADERDEPS="string.h" \
       strlcat strlcpy
       
    mk_msg "compile prefix: $MK_PREFIX"

    mk_define SIGYN_ROOT \"$MK_PREFIX\"
}

make()
{
    UNAME=`uname -s`

    if [ "$UNAME" == "SunOS" ]; then
        LIBS="mowgli socket"
    elif [ "$UNAME" == "MINGW_NT*" ]; then
        LIBS="mowgli wsock32"
    else
        LIBS="mowgli"
    fi

    mk_stage \
        SOURCE="dist/config.example" \
        DEST="$MK_PREFIX/etc/sigyn.ini.example"

        mk_program \
            PROGRAM=sigyn \
            SOURCES="src/*.c" \
            INCLUDEDIRS="include libmowgli/src/libmowgli" \
            LIBDEPS="$LIBS" \
            LDFLAGS="-Wl,-export-dynamic"

    mk_dlo \
        DLO="core/ping" \
        SOURCES="modules/core/ping.c" \
        INCLUDEDIRS="include libmowgli/src/libmowgli" \
        INSTALLDIR="$MK_PREFIX/modules"

    mk_dlo \
    DLO="example/dns" \
    SOURCES="modules/example/dns.c" \
    INCLUDEDIRS="include libmowgli/src/libmowgli" \
    INSTALLDIR="$MK_PREFIX/modules"

    mk_dlo \
    DLO="example/hello" \
    SOURCES="modules/example/hello.c" \
    INCLUDEDIRS="include libmowgli/src/libmowgli" \
    INSTALLDIR="$MK_PREFIX/modules"

    mk_dlo \
    DLO="admin/raw" \
    SOURCES="modules/admin/raw.c" \
    INCLUDEDIRS="include libmowgli/src/libmowgli" \
    INSTALLDIR="$MK_PREFIX/modules"

    mk_dlo \
    DLO="core/help" \
    SOURCES="modules/core/help.c" \
    INCLUDEDIRS="include libmowgli/src/libmowgli" \
    INSTALLDIR="$MK_PREFIX/modules"

}
